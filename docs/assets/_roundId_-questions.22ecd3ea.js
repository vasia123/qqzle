import{_ as we}from"./nuxt-link.b68bb62a.js";import{_ as ye}from"./TitleCard.vue.349652ca.js";import{_ as fe}from"./InputTextarea.vue.5d5e6f90.js";import{_ as ke,u as xe}from"./useUploadImage.25cee66c.js";import{_ as Ue}from"./InputText.vue.53b3648d.js";import{_ as Ie}from"./ModalDialog.vue.47bcd132.js";import{_ as Ce}from"./ModalError.vue.45db5179.js";import{f as ne,r,v as De,o as c,c as p,x as z,y as Ve,i as s,a as e,l as $e,z as Me,F as G,g as Te,j as Fe,A as Oe,B as Z,b as w,w as y,k as qe,C as ee,t as te,d as le,m as V,D as oe,E as Re,G as Se,n as N,q as Ae}from"./entry.891d1732.js";import{u as Be}from"./useFirebaseDB.1db3c222.js";const Le=["id"],Qe={class:"modal"},Ee={class:"modal-box"},je=e("p",{class:"py-4"},"Содержимое",-1),Ne=ne({__name:"ModalIndicator",props:{modalId:{},showModal:{type:Boolean}},setup(n){const o=n,v=r(o.showModal||!1);De(o,()=>{o.showModal!==void 0&&(v.value=o.showModal)});const g=o.modalId;return(f,$)=>(c(),p(G,null,[z(e("input",{id:s(g),"onUpdate:modelValue":$[0]||($[0]=k=>$e(v)?v.value=k:null),type:"checkbox",class:"modal-toggle"},null,8,Le),[[Ve,s(v)]]),e("div",Qe,[e("div",Ee,[Me(f.$slots,"content",{},()=>[je])])])],64))}});let P;const Pe=new Uint8Array(16);function ze(){if(!P&&(P=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!P))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return P(Pe)}const i=[];for(let n=0;n<256;++n)i.push((n+256).toString(16).slice(1));function Ge(n,o=0){return(i[n[o+0]]+i[n[o+1]]+i[n[o+2]]+i[n[o+3]]+"-"+i[n[o+4]]+i[n[o+5]]+"-"+i[n[o+6]]+i[n[o+7]]+"-"+i[n[o+8]]+i[n[o+9]]+"-"+i[n[o+10]]+i[n[o+11]]+i[n[o+12]]+i[n[o+13]]+i[n[o+14]]+i[n[o+15]]).toLowerCase()}const He=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),se={randomUUID:He};function We(n,o,v){if(se.randomUUID&&!o&&!n)return se.randomUUID();n=n||{};const g=n.random||(n.rng||ze)();if(g[6]=g[6]&15|64,g[8]=g[8]&63|128,o){v=v||0;for(let f=0;f<16;++f)o[v+f]=g[f];return o}return Ge(g)}const Je={key:0},Ke={class:"overflow-x-auto w-full"},Xe={class:"mb-1"},Ye=["onClick"],Ze=["onClick"],et=["disabled","onClick"],tt=e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-arrow-up",viewBox:"0 0 16 16"},[e("path",{"fill-rule":"evenodd",d:"M8 15a.5.5 0 0 0 .5-.5V2.707l3.146 3.147a.5.5 0 0 0 .708-.708l-4-4a.5.5 0 0 0-.708 0l-4 4a.5.5 0 0 0 .708.708L7.5 2.707V14.5a.5.5 0 0 0 .5.5z"})],-1),ot=[tt],st=["disabled","onClick"],nt=e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-arrow-down",viewBox:"0 0 16 16"},[e("path",{"fill-rule":"evenodd",d:"M8 1a.5.5 0 0 1 .5.5v11.793l3.146-3.147a.5.5 0 0 1 .708.708l-4 4a.5.5 0 0 1-.708 0l-4-4a.5.5 0 0 1 .708-.708L7.5 13.293V1.5a.5.5 0 0 1 .5-.5z"})],-1),lt=[nt],at={key:1},ut={class:"flex justify-between mt-8"},it=e("h3",{class:"font-bold text-lg"},"Добавление вопроса",-1),rt={class:"grid grid-cols-1 gap-6"},dt={key:0},ct={class:"form-control w-full"},mt=e("label",{class:"label"},[e("span",{class:"label-text text-base-content"}," Тип вопроса ")],-1),pt=e("option",{value:"text"},"Текст",-1),vt=e("option",{value:"img_text"},"Изображение + Текст",-1),_t=[pt,vt],gt={key:2},ht=["src"],bt={class:"form-control w-full"},wt=e("label",{class:"label"},[e("span",{class:"label-text text-base-content"}," Тип ответа ")],-1),yt=e("option",{value:"text"},"Текст",-1),ft=e("option",{value:"options"},"Варианты",-1),kt=e("option",{value:"number"},"Число",-1),xt=[yt,ft,kt],Ut={key:3},It=["onUpdate:modelValue"],Ct=["onClick"],Dt={key:4},Vt=["src"],$t=e("h3",{class:"font-bold text-lg"},"Подтверждение удаления",-1),Mt=e("p",{class:"py-4"},"Вы уверены, что хотите удалить этот вопрос?",-1),Tt=e("p",{class:"py-4"},[e("span",{class:"loading loading-spinner"}),le(" Идёт загрузка... ")],-1),Et=ne({__name:"[roundId]-questions",async setup(n){let o,v;const{gamesAndQuestionsCol:g}=Be(),{uploadFile:f,resizeImage:$}=xe(),k=Te();let M;Array.isArray(k.params.gameId)?M=k.params.gameId.join(""):M=k.params.gameId;let x;Array.isArray(k.params.roundId)?x=parseInt(k.params.roundId.join("")):x=parseInt(k.params.roundId);const u=r([]),T=r(!1),h=r(!1);let C=null;const F=r(null),O=r(""),H=r(""),q=r(null),R=r(null),S=r(0),A=r(""),B=r(null),L=r(null),Q=r(!1),l=r({ID:"",sortOrder:0,questionType:"text",text:"",guessType:"text",image:"",sound:"",answer:"",guessOptions:[]}),W=(t=null)=>{console.log("questionIndex",t),t!==null?(l.value={...u.value[t]},L.value=t):(l.value={ID:"",sortOrder:0,questionType:"text",text:"",image:"",sound:"",guessType:"text",answer:"",guessOptions:[]},L.value=null),O.value=l.value.image||"",H.value=l.value.sound||"",R.value=l.value.image||"",B.value=l.value.sound||"",Q.value=!0},ae=()=>{l.value.guessOptions.push("")},ue=t=>{h.value=!0,F.value=t,$(t,a=>{const U=URL.createObjectURL(a);R.value=U,h.value=!1})},ie=t=>{q.value=t;const a=URL.createObjectURL(t);B.value=a},re=async()=>{const t=b.rounds.find((a,U)=>U===x);if(!t){A.value="Тур не найден";return}console.log("imageFileUrl.value2",O.value),l.value.image=O.value,l.value.sound=H.value,L.value!==null?u.value[L.value]=l.value:(l.value.ID=We(),l.value.sortOrder=t.questions.length,u.value.push(l.value)),b.rounds[x].questions=u.value,await N(D,{rounds:b.rounds})},J=(t,a="images")=>new Promise((U,E)=>{const j=f(t,a);j.on("state_changed",m=>{S.value=m.bytesTransferred/m.totalBytes*100},m=>{console.error("Ошибка загрузки:",m),E(m.message)},async()=>{try{const m=await Ae(j.snapshot.ref);U(m)}catch(m){E(m)}})}),de=async()=>{if(l.value.text.trim()===""){A.value="Введите текст вопроса";return}h.value=!0;try{F.value&&(O.value=await J(F.value),F.value=null),q.value&&(H.value=await J(q.value,"sounds"),q.value=null),await re(),Q.value=!1,h.value=!1}catch(t){h.value=!1,t instanceof Error?A.value=t.message:console.error("Unexpected error",t)}},ce=t=>{l.value.guessOptions.splice(t,1)},me=async t=>{if(t>0){const a=u.value[t-1];u.value[t-1]=u.value[t],u.value[t]=a,h.value=!0,b.rounds[x].questions=u.value,await N(D,{rounds:b.rounds}),h.value=!1}},pe=async t=>{if(t<u.value.length-1){const a=u.value[t+1];u.value[t+1]=u.value[t],u.value[t]=a,h.value=!0,b.rounds[x].questions=u.value,await N(D,{rounds:b.rounds}),h.value=!1}},D=Fe(g,M),K=([o,v]=Oe(()=>qe(D)),o=await o,v(),o);if(!K.exists())throw Z({statusCode:404,statusMessage:"Игра не найдена"});const b=K.data(),X=b.rounds[x];if(X)u.value=X.questions;else throw Z({statusCode:404,statusMessage:"Раунд не найден"});const ve=t=>{C=t,T.value=!0},_e=async()=>{C&&C>-1&&(u.value.splice(C,1),b.rounds[x].questions=u.value,await N(D,{rounds:b.rounds}),C=null,T.value=!1)};return(t,a)=>{const U=we,E=ye,j=fe,m=ke,ge=Ue,Y=Ie,he=Ce,be=Ne;return c(),p(G,null,[w(E,{title:"Управление вопросами раунда"},{default:y(()=>[s(u).length>0?(c(),p("div",Je,[e("div",Ke,[(c(!0),p(G,null,ee(s(u),(d,_)=>(c(),p("div",{key:d.ID,class:"my-2 p-2"},[e("div",Xe,te(d.text),1),e("button",{class:"btn btn-primary mr-2",onClick:I=>W(_)}," Редактировать ",8,Ye),e("button",{class:"btn btn-error mr-2",onClick:I=>ve(_)}," Удалить ",8,Ze),e("button",{class:"btn btn-secondary mr-2",disabled:_===0,onClick:I=>me(_)},ot,8,et),e("button",{class:"btn btn-secondary",disabled:_===s(u).length-1,onClick:I=>pe(_)},lt,8,st)]))),128))])])):(c(),p("div",at,"пока пусто")),e("div",ut,[w(U,{class:"btn btn-ghost",to:"/admin/games/"+s(M)+"/rounds"},{default:y(()=>[le("Вернуться")]),_:1},8,["to"]),e("button",{class:"btn btn-primary",onClick:a[0]||(a[0]=d=>W(null))}," Добавить вопрос ")])]),_:1}),w(Y,{"modal-id":"add-question-modal","show-modal":s(Q)},{title:y(()=>[it]),content:y(()=>[e("div",rt,[w(j,{modelValue:s(l).text,"onUpdate:modelValue":a[1]||(a[1]=d=>s(l).text=d),"label-title":"Текст вопроса"},null,8,["modelValue"]),s(S)>0&&s(S)<100?(c(),p("div",dt," Загрузка: "+te(s(S))+"% ",1)):V("",!0),e("div",ct,[mt,z(e("select",{"onUpdate:modelValue":a[2]||(a[2]=d=>s(l).questionType=d),class:"select select-bordered"},_t,512),[[oe,s(l).questionType]])]),s(l).questionType==="img_text"?(c(),Re(m,{key:1,"label-title":"Изображение вопроса",onFileSelected:ue})):V("",!0),s(R)?(c(),p("div",gt,[e("img",{src:s(R),alt:"Превью изображения"},null,8,ht)])):V("",!0),e("div",bt,[wt,z(e("select",{"onUpdate:modelValue":a[3]||(a[3]=d=>s(l).guessType=d),class:"select select-bordered"},xt,512),[[oe,s(l).guessType]])]),s(l).guessType==="options"?(c(),p("div",Ut,[(c(!0),p(G,null,ee(s(l).guessOptions,(d,_)=>(c(),p("div",{key:_,class:"option-container"},[z(e("input",{"onUpdate:modelValue":I=>s(l).guessOptions[_]=I,type:"text",placeholder:"Вариант ответа",class:"input input-bordered"},null,8,It),[[Se,s(l).guessOptions[_]]]),e("button",{class:"btn btn-error",onClick:I=>ce(_)}," Удалить ",8,Ct)]))),128)),e("button",{class:"btn btn-primary mt-2",onClick:ae}," Добавить вариант ")])):V("",!0),w(ge,{modelValue:s(l).answer,"onUpdate:modelValue":a[4]||(a[4]=d=>s(l).answer=d),"label-title":"Ответ"},null,8,["modelValue"]),w(m,{"label-title":"Звук вопроса",onFileSelected:ie}),s(B)?(c(),p("div",Dt,[e("audio",{src:s(B),controls:""},null,8,Vt)])):V("",!0)])]),actions:y(()=>[e("label",{class:"btn",onClick:a[5]||(a[5]=d=>Q.value=!1)},"Отмена"),e("button",{class:"btn btn-primary",onClick:de}," Сохранить ")]),_:1},8,["show-modal"]),w(Y,{"modal-id":"delete-modal","show-modal":s(T)},{title:y(()=>[$t]),content:y(()=>[Mt]),actions:y(()=>[e("label",{class:"btn",onClick:a[6]||(a[6]=d=>T.value=!1)},"Отмена"),e("button",{class:"btn btn-error",onClick:_e},"Удалить")]),_:1},8,["show-modal"]),w(he,{message:s(A)},null,8,["message"]),w(be,{"modal-id":"loading-modal","show-modal":s(h)},{content:y(()=>[Tt]),_:1},8,["show-modal"])],64)}}});export{Et as default};
