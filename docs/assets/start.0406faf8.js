import{_ as me}from"./InputText.vue.53b3648d.js";import{_ as _e}from"./ModalError.vue.45db5179.js";import{u as ge}from"./useFirebaseDB.1db3c222.js";import{f as Ie,r as l,g as ye,j as X,A as E,B as he,L as G,M as f,N as be,o as u,c as o,a as s,i as e,E as we,l as fe,m as p,t as v,d as F,F as C,C as M,b as pe,k as xe,O as j,P as ke,n as g,H as Ae}from"./entry.891d1732.js";const De={key:2},Ce={key:0},Re=["src"],qe=["disabled"],Qe={key:3},Se={key:0},Ne=["onClick"],Ve=["disabled"],Be={key:1},Ee=s("th",null,"Пользователь",-1),Ge=s("th",null,"Общий балл",-1),Fe={key:0},Me={class:"mt-8"},je=["href"],He=Ie({__name:"start",async setup($e){let c,I;const{gamesAndQuestionsCol:Y,ongoingGamesCol:R,userAnswersCol:P}=ge(),x=l(!1),$=ye();let y;Array.isArray($.params.gameId)?y=$.params.gameId.join(""):y=$.params.gameId;const Z=l(""),q=l(""),ee=X(Y,y),U=([c,I]=E(()=>xe(ee)),c=await c,I(),c);if(!U.exists())throw he({statusCode:404,statusMessage:"Игра не найдена"});const a=U.data(),w=l({});let L=G(R,f("gameID","==",y)),O=([c,I]=E(()=>j(L)),c=await c,I(),c);O.docs.length<1&&([c,I]=E(()=>ke(R,{code:"",gameID:y,status:"init",currentRoundIndex:0,currentQuestionIndex:0,currentAnswersIndex:-1})),await c,I(),L=G(R,f("gameID","==",y)),O=([c,I]=E(()=>j(L)),c=await c,I(),c));const T=O.docs[0],Q=T.data(),h=X(R,T.id),t=l(Q.currentRoundIndex),r=l(Q.currentQuestionIndex),d=l(Q.currentAnswersIndex),m=l(),b=l(),k=l(),S=l(!1),z=l(!1),A=l([]),H=l([]);m.value=a.rounds[t.value].questions[r.value],k.value=a.rounds[t.value];const N=l(Q.status==="started"),se=be(()=>r.value>=a.rounds[t.value].questions.length),te=async()=>{await g(h,{code:q.value,status:"started",currentRoundIndex:0,currentQuestionIndex:-1}),N.value=!0,m.value=a.rounds[0].questions[0]},ne=async()=>{r.value<a.rounds[t.value].questions.length-1?(r.value++,await g(h,{currentAnswersIndex:-1,currentQuestionIndex:r.value}),m.value=a.rounds[t.value].questions[r.value]):(x.value=!0,d.value=0,b.value=a.rounds[t.value].questions[d.value],await g(h,{currentAnswersIndex:d.value}),await J(b.value))},ae=async()=>{d.value>0?(d.value--,await g(h,{currentAnswersIndex:d.value}),k.value=a.rounds[t.value],b.value=a.rounds[t.value].questions[d.value]):(K(),d.value=-1,await g(h,{currentAnswersIndex:-1}))},J=async _=>{const D=G(P,f("roundID","==",t.value),f("questionID","==",_.ID),f("gameID","==",y)),V=await j(D);H.value=[],A.value=V.docs.map(n=>(H.value.push(n.ref),n.data()))},ue=async()=>{d.value++,d.value<a.rounds[t.value].questions.length-1?(await g(h,{currentAnswersIndex:d.value}),b.value=a.rounds[t.value].questions[d.value],await J(b.value)):(z.value=!0,ie())},oe=async()=>{z.value=!1,K(),await le()},re=async _=>{A.value[_].correct=!A.value[_].correct,await g(H.value[_],{correct:A.value[_].correct})},le=async()=>{t.value<a.rounds.length-1?(t.value++,r.value=0,d.value=-1,x.value=!1,await g(h,{currentRoundIndex:t.value,currentAnswersIndex:d.value,currentQuestionIndex:r.value}),k.value=a.rounds[t.value],m.value=a.rounds[t.value].questions[r.value]):S.value=!0},ce=async()=>{r.value>0?r.value--:t.value>0&&(t.value--,r.value=a.rounds[t.value].questions.length-1),await g(h,{currentRoundIndex:t.value,currentQuestionIndex:r.value}),k.value=a.rounds[t.value],m.value=a.rounds[t.value].questions[r.value]},de=()=>{x.value=!0},K=()=>{x.value=!1},ie=async()=>{const _=G(P,f("roundID","==",t.value),f("gameID","==",y));(await j(_)).docs.map(n=>n.data()).forEach(n=>{w.value[n.userID]||(w.value[n.userID]={userName:n.userName,scores:[],totalScore:0}),w.value[n.userID].scores[n.roundID]||(w.value[n.userID].scores[n.roundID]=0),n.correct&&(w.value[n.userID].scores[n.roundID]+=1),n.correct&&(w.value[n.userID].totalScore+=1)})};return(_,D)=>{const V=me,n=_e;return u(),o(C,null,[s("div",null,[e(N)?p("",!0):(u(),we(V,{key:0,modelValue:e(q),"onUpdate:modelValue":D[0]||(D[0]=i=>fe(q)?q.value=i:null),type:"text","label-title":"Код для присоединения"},null,8,["modelValue"])),e(N)?p("",!0):(u(),o("button",{key:1,class:"btn btn-primary mr-2",onClick:te}," Начать игру ")),!e(S)&&e(N)&&e(m)&&e(k)&&!e(x)?(u(),o("div",De,[s("h2",null,"Раунд: "+v(e(k).name),1),s("h1",null,[F(" Вопрос: "),s("b",null,v(e(m).text),1)]),e(m).sound?(u(),o("div",Ce,[s("audio",{src:e(m).sound,controls:""},null,8,Re)])):p("",!0),s("button",{class:"btn btn-primary mr-2",disabled:e(r)===0&&e(t)==0,onClick:ce}," Предыдущий Вопрос ",8,qe),s("button",{class:"btn btn-primary mr-2",onClick:ne}," Следующий Вопрос "),e(se)?(u(),o("button",{key:1,class:"btn btn-primary mr-2",onClick:de}," Показать Ответы ")):p("",!0)])):p("",!0),!e(S)&&e(x)&&e(b)?(u(),o("div",Qe,[e(z)?(u(),o("div",Be,[s("table",null,[s("thead",null,[s("tr",null,[Ee,(u(!0),o(C,null,M(Object.keys(e(a).rounds),i=>(u(),o("th",{key:i},v(i),1))),128)),Ge])]),s("tbody",null,[(u(!0),o(C,null,M(e(w),(i,B)=>(u(),o("tr",{key:B},[s("td",null,v(i.userName),1),(u(!0),o(C,null,M(i.scores,(W,ve)=>(u(),o("td",{key:ve},v(W||0),1))),128)),s("td",null,v(i.totalScore),1)]))),128))])]),s("button",{class:"btn btn-primary mr-2",onClick:oe}," Следующий тур ")])):(u(),o("div",Se,[s("div",null,[F(" Вопрос: "),s("b",null,v(e(b).text),1)]),s("div",null,[F(" Ответ:"),s("b",null,v(e(b).answer),1)]),(u(!0),o(C,null,M(e(A),(i,B)=>(u(),o("div",{key:B,class:"py-5"},[s("b",null,v(i.userName),1),F(" - Ответ: "),s("b",null,v(i.answer),1),s("button",{class:Ae(["btn mx-2",{"btn-accent":i.correct,"btn-error":!i.correct}]),onClick:W=>re(B)},v(i.correct?"Правильно":"Не правильно"),11,Ne)]))),128)),s("button",{class:"btn btn-primary mr-2",disabled:e(r)===0&&e(t)==0,onClick:ae}," Предыдущий Вопрос ",8,Ve),s("button",{class:"btn btn-primary mr-2",onClick:ue}," Следующий Вопрос ")]))])):p("",!0)]),e(S)?(u(),o("div",Fe,"Игра закончена")):p("",!0),s("div",Me,[s("a",{href:"/games/"+e(T).id+"/show",target:"_blank"},"открыть просмотр",8,je)]),pe(n,{message:e(Z)},null,8,["message"])],64)}}});export{He as default};
