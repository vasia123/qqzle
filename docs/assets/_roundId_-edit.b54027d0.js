import{_ as S}from"./InputText.vue.53b3648d.js";import{_ as $,u as L}from"./useUploadImage.25cee66c.js";import{_ as E}from"./InputTextarea.vue.5d5e6f90.js";import{_ as M}from"./nuxt-link.b68bb62a.js";import{_ as P}from"./TitleCard.vue.349652ca.js";import{_ as q}from"./ModalError.vue.45db5179.js";import{f as z,g as O,r as l,o as b,c as I,b as m,w as V,i as t,F as Q,j as k,k as U,l as h,a as F,m as R,t as G,d as T,q as H,n as J,s as K}from"./entry.891d1732.js";import{u as W}from"./useFirebaseDB.1db3c222.js";const X={key:0},Y=["src"],Z={key:1},ee={class:"flex justify-between mt-8"},ae=["disabled"],te={key:0,class:"loading loading-spinner"},_e=z({__name:"[roundId]-edit",setup(oe){const r=O(),{gamesAndQuestionsCol:w}=W(),{uploadFile:C,resizeImage:N}=L();let i;Array.isArray(r.params.gameId)?i=r.params.gameId.join(""):i=r.params.gameId;let f;Array.isArray(r.params.roundId)?f=r.params.roundId.join(""):f=r.params.roundId;const c=l(""),_=l(""),p=l(""),d=l(!1),x=l(null),g=l(null),v=l(0),j=e=>{d.value=!0,x.value=e,N(e,a=>{const u=URL.createObjectURL(a);g.value=u,d.value=!1})};(async()=>{const e=k(w,i),a=await U(e);if(a.exists()){const o=a.data().rounds.find((y,s)=>s.toString()===f);o?(_.value=o.name,p.value=o.description,g.value=o.image):c.value="Тур не найден"}else c.value="Игра не найдена"})();const A=async()=>{d.value=!0;try{const e=k(w,i),a=await U(e);if(a.exists()){const u=a.data();let o=g.value;if(x.value){const s=C(x.value);s.on("state_changed",n=>{v.value=n.bytesTransferred/n.totalBytes*100},n=>{console.error("Ошибка загрузки:",n)},async()=>{o=await H(s.snapshot.ref)})}const y=u.rounds.map((s,n)=>n.toString()===f?{...s,name:_.value,description:p.value,image:o}:s);await J(e,{rounds:y}),await K("/admin/games/"+i+"/rounds")}else c.value="Игра не найдена"}catch(e){d.value=!1,e instanceof Error?c.value=e.message:console.error("Unexpected error",e)}};return(e,a)=>{const u=S,o=$,y=E,s=M,n=P,B=q;return b(),I(Q,null,[m(n,{title:"Редактирование тура"},{default:V(()=>[m(u,{modelValue:t(_),"onUpdate:modelValue":a[0]||(a[0]=D=>h(_)?_.value=D:null),type:"text","label-title":"Название тура"},null,8,["modelValue"]),m(o,{"label-title":"Изображение тура",onFileSelected:j}),t(g)?(b(),I("div",X,[F("img",{src:t(g),alt:"Превью изображения"},null,8,Y)])):R("",!0),t(v)>0&&t(v)<100?(b(),I("div",Z," Загрузка: "+G(t(v))+"% ",1)):R("",!0),m(y,{modelValue:t(p),"onUpdate:modelValue":a[1]||(a[1]=D=>h(p)?p.value=D:null),"label-title":"Описание"},null,8,["modelValue"]),F("div",ee,[m(s,{class:"btn btn-ghost",to:"/admin/games/"+t(i)+"/rounds"},{default:V(()=>[T("Отмена")]),_:1},8,["to"]),F("button",{class:"btn btn-primary",disabled:t(d),onClick:A},[t(d)?(b(),I("span",te)):R("",!0),T(" Сохранить изменения ")],8,ae)])]),_:1}),m(B,{message:t(c)},null,8,["message"])],64)}}});export{_e as default};
